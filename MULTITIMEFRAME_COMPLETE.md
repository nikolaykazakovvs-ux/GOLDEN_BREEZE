# ‚úÖ –ú—É–ª—å—Ç–∏—Ç–∞–π–º—Ñ—Ä–µ–π–º–æ–≤–∞—è –ê—Ä—Ö–∏—Ç–µ–∫—Ç—É—Ä–∞ - –†–ï–ê–õ–ò–ó–û–í–ê–ù–û

## üéØ –°—Ç–∞—Ç—É—Å: –ó–ê–í–ï–†–®–ï–ù–û

**–î–∞—Ç–∞:** 2024-12-01  
**–í–µ—Ä—Å–∏—è:** Golden Breeze Hybrid Strategy v1.0 + Multitimeframe  

---

## üìù –ö—Ä–∞—Ç–∫–æ–µ —Ä–µ–∑—é–º–µ

–£—Å–ø–µ—à–Ω–æ –∏–Ω—Ç–µ–≥—Ä–∏—Ä–æ–≤–∞–Ω–∞ **–º—É–ª—å—Ç–∏—Ç–∞–π–º—Ñ—Ä–µ–π–º–æ–≤–∞—è –ª–æ–≥–∏–∫–∞** –≤ Golden Breeze Hybrid Strategy v1.0 —Å–æ–≥–ª–∞—Å–Ω–æ –≤–∞—à–∏–º —Ç—Ä–µ–±–æ–≤–∞–Ω–∏—è–º:

> ‚úÖ "–°—Ç—Ä–∞—Ç–µ–≥–∏—è –≤—Å–µ–≥–¥–∞ —á–∏—Ç–∞–µ—Ç –≤—Å–µ —Ç–∞–π–º—Ñ—Ä–µ–π–º—ã –¥–ª—è –ø—Ä–∏–Ω—è—Ç–∏—è —Ä–µ—à–µ–Ω–∏–π"  
> ‚úÖ "–ú—É–ª—å—Ç–∏—Ç–∞–π–º—Ñ—Ä–µ–π–º –æ–±—è–∑–∞—Ç–µ–ª—å–Ω–æ —á–∏—Ç–∞–µ—Ç –≤—Å–µ —Ç–∞–π–º—Ñ—Ä–µ–π–º—ã"  
> ‚úÖ "PRIMARY_TF –º–æ–∂–µ—Ç –¥–∏–Ω–∞–º–∏—á–µ—Å–∫–∏ –º–µ–Ω—è—Ç—å—Å—è"  
> ‚úÖ "–í—Å—ë —Ä–µ—à–∞–µ—Ç—Å—è –ø–æ —Ü–µ–Ω–µ –≤–Ω—É—Ç—Ä–∏ —Å–≤–µ—á–∏, –∞ –Ω–µ –ø–æ —Ç—É–ø—ã–º Open/Close"

---

## üìä –ß—Ç–æ —Ä–µ–∞–ª–∏–∑–æ–≤–∞–Ω–æ

### 1. ‚úÖ TimeframeSelector (350 —Å—Ç—Ä–æ–∫)

**–§–∞–π–ª:** `strategy/timeframe_selector.py`

**–§—É–Ω–∫—Ü–∏–æ–Ω–∞–ª:**
- –î–∏–Ω–∞–º–∏—á–µ—Å–∫–∏–π –≤—ã–±–æ—Ä PRIMARY_TF (M5/M15/H1)
- –ê–Ω–∞–ª–∏–∑ –∫–æ–Ω—Ç–µ–∫—Å—Ç–∞ —Å—Ç–∞—Ä—à–∏—Ö TF (H1/H4)
- –§–∏–ª—å—Ç—Ä—ã –ø–æ confidence –∏ —Ä–µ–∂–∏–º—É
- –ó–∞—â–∏—Ç–∞ –æ—Ç –≤–æ–ª–∞—Ç–∏–ª—å–Ω–æ—Å—Ç–∏
- –ò—Å—Ç–æ—Ä–∏—è —Ä–µ—à–µ–Ω–∏–π –¥–ª—è –æ—Ç–ª–∞–¥–∫–∏

**–ö–ª–∞—Å—Å—ã:**
- `Timeframe(Enum)`: M1, M5, M15, H1, H4
- `Regime(Enum)`: TREND_UP, TREND_DOWN, RANGE, VOLATILE, UNKNOWN
- `TimeframeData`: –î–∞–Ω–Ω—ã–µ –ø–æ TF
- `TimeframeDecision`: –†–µ—à–µ–Ω–∏–µ —Å–µ–ª–µ–∫—Ç–æ—Ä–∞
- `TimeframeSelector`: –õ–æ–≥–∏–∫–∞ –≤—ã–±–æ—Ä–∞

### 2. ‚úÖ AIClient.predict_multitimeframe()

**–§–∞–π–ª:** `strategy/ai_client.py` (+80 —Å—Ç—Ä–æ–∫)

**–§—É–Ω–∫—Ü–∏–æ–Ω–∞–ª:**
- –ó–∞–ø—Ä–æ—Å AI —Å–∏–≥–Ω–∞–ª–æ–≤ –ø–æ –≤—Å–µ–º TF –æ–¥–Ω–æ–≤—Ä–µ–º–µ–Ω–Ω–æ
- Endpoint: `/predict_multitimeframe`
- Fallback: –ø–æ—Å–ª–µ–¥–æ–≤–∞—Ç–µ–ª—å–Ω—ã–µ –∑–∞–ø—Ä–æ—Å—ã `/predict`
- –ú–µ—Ç–æ–¥ `get_last_multitf_signals()`

### 3. ‚úÖ StrategyConfig (–æ–±–Ω–æ–≤–ª—ë–Ω)

**–§–∞–π–ª:** `strategy/config.py` (+20 —Å—Ç—Ä–æ–∫)

**–ù–æ–≤—ã–µ –ø–∞—Ä–∞–º–µ—Ç—Ä—ã:**
```python
primary_tf: str = "M5"
supported_timeframes: List[str] = ["M1", "M5", "M15", "H1", "H4"]
execution_tf: str = "M1"
context_tf_high: str = "H1"
tf_selector_enable: bool = True
tf_selector_min_confidence: float = 0.65
tf_selector_high_confidence: float = 0.8
```

### 4. ‚úÖ HybridStrategy (–ø–µ—Ä–µ—Ä–∞–±–æ—Ç–∞–Ω)

**–§–∞–π–ª:** `strategy/hybrid_strategy.py` (+120 —Å—Ç—Ä–æ–∫)

**–ò–∑–º–µ–Ω–µ–Ω–∏—è:**
- –ò–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏—è `TimeframeSelector`
- `on_new_candle()` –ø—Ä–∏–Ω–∏–º–∞–µ—Ç `multitf_data`
- Workflow: AI —Å–∏–≥–Ω–∞–ª—ã ‚Üí –í—ã–±–æ—Ä PRIMARY_TF ‚Üí –ì–µ–Ω–µ—Ä–∞—Ü–∏—è —Å–∏–≥–Ω–∞–ª–∞
- –ú–µ—Ç–æ–¥—ã:
  - `_request_multitf_signals()` - –∑–∞–ø—Ä–æ—Å AI –ø–æ –≤—Å–µ–º TF
  - `_select_primary_timeframe()` - –≤—ã–∑–æ–≤ —Å–µ–ª–µ–∫—Ç–æ—Ä–∞
- –•—Ä–∞–Ω–µ–Ω–∏–µ `current_primary_tf`, `current_multitf_signals`, `current_tf_decision`

### 5. ‚úÖ BacktestEngine (–æ–±–Ω–æ–≤–ª—ë–Ω)

**–§–∞–π–ª:** `strategy/backtest_engine.py` (+50 —Å—Ç—Ä–æ–∫)

**–ù–æ–≤—ã–µ –º–µ—Ç–æ–¥—ã:**
- `load_multitf_data(data_dict)` - –∑–∞–≥—Ä—É–∑–∫–∞ –¥–∞–Ω–Ω—ã—Ö –ø–æ –≤—Å–µ–º TF
- `_sync_multitf_data()` - —Å–∏–Ω—Ö—Ä–æ–Ω–∏–∑–∞—Ü–∏—è –ø–æ –≤—Ä–µ–º–µ–Ω–∏

**–ò–∑–º–µ–Ω–µ–Ω–∏—è:**
- `run()` –ø–µ—Ä–µ–¥–∞—ë—Ç `synced_multitf_data` –≤ `on_new_candle()`

### 6. ‚úÖ –î–æ–∫—É–º–µ–Ω—Ç–∞—Ü–∏—è

**–§–∞–π–ª—ã:**
- `MULTITIMEFRAME_SPECIFICATION.md` (500 —Å—Ç—Ä–æ–∫) - –ø–æ–ª–Ω–∞—è —Å–ø–µ—Ü–∏—Ñ–∏–∫–∞—Ü–∏—è
- `MULTITIMEFRAME_CHANGELOG.md` (350 —Å—Ç—Ä–æ–∫) - —Å–≤–æ–¥–∫–∞ –∏–∑–º–µ–Ω–µ–Ω–∏–π
- `README.md` - –æ–±–Ω–æ–≤–ª—ë–Ω —Å —É–ø–æ–º–∏–Ω–∞–Ω–∏—è–º–∏ multitimeframe

---

## üìê –ê—Ä—Ö–∏—Ç–µ–∫—Ç—É—Ä–∞

```
‚îå‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îê
‚îÇ                    BacktestEngine                           ‚îÇ
‚îÇ  ‚Ä¢ load_multitf_data({M5: df, M15: df, H1: df, H4: df})   ‚îÇ
‚îÇ  ‚Ä¢ _sync_multitf_data() ‚Üí —Å–∏–Ω—Ö—Ä–æ–Ω–∏–∑–∞—Ü–∏—è –ø–æ –≤—Ä–µ–º–µ–Ω–∏          ‚îÇ
‚îî‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚î¨‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îò
                       ‚îÇ
                       ‚ñº
‚îå‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îê
‚îÇ                  HybridStrategy                             ‚îÇ
‚îÇ  ‚îå‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îê  ‚îÇ
‚îÇ  ‚îÇ on_new_candle(candle, data, multitf_data)           ‚îÇ  ‚îÇ
‚îÇ  ‚îÇ                                                       ‚îÇ  ‚îÇ
‚îÇ  ‚îÇ  –®–ê–ì 1: _request_multitf_signals()                  ‚îÇ  ‚îÇ
‚îÇ  ‚îÇ         ‚Üì                                            ‚îÇ  ‚îÇ
‚îÇ  ‚îÇ      AIClient.predict_multitimeframe()              ‚îÇ  ‚îÇ
‚îÇ  ‚îÇ         {M5: signal, M15: signal, H1: ..., H4: ...} ‚îÇ  ‚îÇ
‚îÇ  ‚îÇ                                                       ‚îÇ  ‚îÇ
‚îÇ  ‚îÇ  –®–ê–ì 2: _select_primary_timeframe()                 ‚îÇ  ‚îÇ
‚îÇ  ‚îÇ         ‚Üì                                            ‚îÇ  ‚îÇ
‚îÇ  ‚îÇ      TimeframeSelector.select_timeframe()           ‚îÇ  ‚îÇ
‚îÇ  ‚îÇ         ‚Üí PRIMARY_TF = M5 (–∏–ª–∏ M15/H1)              ‚îÇ  ‚îÇ
‚îÇ  ‚îÇ         ‚Üí should_trade = True/False                  ‚îÇ  ‚îÇ
‚îÇ  ‚îÇ         ‚Üí reason + context_filter                    ‚îÇ  ‚îÇ
‚îÇ  ‚îÇ                                                       ‚îÇ  ‚îÇ
‚îÇ  ‚îÇ  –®–ê–ì 3: _generate_trading_signal()                  ‚îÇ  ‚îÇ
‚îÇ  ‚îÇ         –Ω–∞ PRIMARY_TF —Å –¥–∞–Ω–Ω—ã–º–∏ multitf_data[TF]    ‚îÇ  ‚îÇ
‚îÇ  ‚îÇ                                                       ‚îÇ  ‚îÇ
‚îÇ  ‚îÇ  –®–ê–ì 4: –ò–Ω—Ç—Ä–∞–±–∞—Ä–Ω–æ–µ –∏—Å–ø–æ–ª–Ω–µ–Ω–∏–µ (M1/—Ç–∏–∫–∏)           ‚îÇ  ‚îÇ
‚îÇ  ‚îî‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îò  ‚îÇ
‚îî‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îò
```

---

## üéÆ –ü—Ä–∏–º–µ—Ä –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏—è

```python
from strategy import StrategyConfig, HybridStrategy, BacktestEngine

# –ö–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏—è —Å –º—É–ª—å—Ç–∏—Ç–∞–π–º—Ñ—Ä–µ–π–º–æ–º
config = StrategyConfig(
    primary_tf="M5",
    supported_timeframes=["M1", "M5", "M15", "H1", "H4"],
    tf_selector_enable=True,
    tf_selector_min_confidence=0.65,
    tf_selector_high_confidence=0.8
)

# –°–æ–∑–¥–∞–Ω–∏–µ —Å—Ç—Ä–∞—Ç–µ–≥–∏–∏
strategy = HybridStrategy(config, initial_balance=10000.0)

# Backtesting engine
backtest = BacktestEngine(strategy, config)

# –ó–∞–≥—Ä—É–∑–∫–∞ –º—É–ª—å—Ç–∏—Ç–∞–π–º—Ñ—Ä–µ–π–º–æ–≤—ã—Ö –¥–∞–Ω–Ω—ã—Ö
multitf_data = {
    "M5": df_m5,    # DataFrame —Å OHLCV + –∏–Ω–¥–∏–∫–∞—Ç–æ—Ä—ã
    "M15": df_m15,
    "H1": df_h1,
    "H4": df_h4
}
backtest.load_multitf_data(multitf_data)
backtest.load_m1_data(df_m1)  # –î–ª—è –∏–Ω—Ç—Ä–∞–±–∞—Ä–∞

# –ó–∞–ø—É—Å–∫
backtest.run()

# –†–µ–∑—É–ª—å—Ç–∞—Ç—ã
stats = strategy.get_statistics()
print(f"Current PRIMARY_TF: {stats['current_primary_tf']}")
print(f"TF Decision: {stats['tf_decision']}")
```

---

## üìà –ê–ª–≥–æ—Ä–∏—Ç–º —Ä–∞–±–æ—Ç—ã

### –ü—Ä–∏ –∑–∞–∫—Ä—ã—Ç–∏–∏ M5 —Å–≤–µ—á–∏:

1. **BacktestEngine** –≤—ã–∑—ã–≤–∞–µ—Ç:
   ```python
   strategy.on_new_candle(candle, historical_data, multitf_data)
   ```

2. **HybridStrategy** –≤—ã–ø–æ–ª–Ω—è–µ—Ç:
   - –ó–∞–ø—Ä–æ—Å AI —Å–∏–≥–Ω–∞–ª–æ–≤ –ø–æ M5/M15/H1/H4 –æ–¥–Ω–æ–≤—Ä–µ–º–µ–Ω–Ω–æ
   - TimeframeSelector –∞–Ω–∞–ª–∏–∑–∏—Ä—É–µ—Ç —Å–∏–≥–Ω–∞–ª—ã –∏ –≤—ã–±–∏—Ä–∞–µ—Ç PRIMARY_TF:
     - M5: –µ—Å–ª–∏ confidence ‚â• 0.65, —Ä–µ–∂–∏–º –Ω–µ volatile
     - M15: –µ—Å–ª–∏ M5 –Ω–µ–¥–æ—Å—Ç–∞—Ç–æ—á–Ω–æ —É–≤–µ—Ä–µ–Ω
     - H1: –µ—Å–ª–∏ —Å—Ç–∞—Ä—à–∏–π TF –ø–æ–∫–∞–∑—ã–≤–∞–µ—Ç —á—ë—Ç–∫–∏–π —Ç—Ä–µ–Ω–¥
   - –ü—Ä–æ–≤–µ—Ä–∫–∞ `should_trade` (—Ñ–∏–ª—å—Ç—Ä –≤–æ–ª–∞—Ç–∏–ª—å–Ω–æ—Å—Ç–∏ H1/H4)
   - –ì–µ–Ω–µ—Ä–∞—Ü–∏—è —Å–∏–≥–Ω–∞–ª–∞ –Ω–∞ PRIMARY_TF (–∏—Å–ø–æ–ª—å–∑—É—è –¥–∞–Ω–Ω—ã–µ –∏–∑ `multitf_data[PRIMARY_TF]`)

3. **–ò–Ω—Ç—Ä–∞–±–∞—Ä–Ω–∞—è –æ–±—Ä–∞–±–æ—Ç–∫–∞** (M1/—Ç–∏–∫–∏):
   - –ü—Ä–æ–≤–µ—Ä–∫–∞ pending orders
   - –ò—Å–ø–æ–ª–Ω–µ–Ω–∏–µ SL/TP/trailing
   - –í—Å—ë –ø–æ —Ü–µ–Ω–µ –≤–Ω—É—Ç—Ä–∏ —Å–≤–µ—á–∏, –Ω–µ –ø–æ Open/Close

---

## üéØ –ü—Ä–∏–º–µ—Ä—ã —Å—Ü–µ–Ω–∞—Ä–∏–µ–≤

### –°—Ü–µ–Ω–∞—Ä–∏–π 1: –ß—ë—Ç–∫–∏–π —Ç—Ä–µ–Ω–¥ –Ω–∞ M5

```
AI —Å–∏–≥–Ω–∞–ª—ã:
  M5:  regime=trend_up, confidence=0.75 ‚úÖ
  M15: regime=trend_up, confidence=0.70
  H1:  regime=trend_up, confidence=0.85
  H4:  regime=trend_up, confidence=0.80

TimeframeSelector:
  ‚Üí PRIMARY_TF = M5
  ‚Üí Reason: "M5 confidence=0.75, regime=trend_up, aligned with H1"
  ‚Üí should_trade = True
  ‚Üí Context: "H1: —Ç—Ä–µ–Ω–¥ long | H4: —Ç—Ä–µ–Ω–¥ long"

–†–µ–∑—É–ª—å—Ç–∞—Ç: –û—Ç–∫—Ä—ã–≤–∞–µ–º LONG –Ω–∞ M5 (TrendStrategy)
```

### –°—Ü–µ–Ω–∞—Ä–∏–π 2: M5 –≤ —Ö–∞–æ—Å–µ, –ø–µ—Ä–µ—Ö–æ–¥ –Ω–∞ M15

```
AI —Å–∏–≥–Ω–∞–ª—ã:
  M5:  regime=volatile, confidence=0.45 ‚ùå
  M15: regime=range, confidence=0.72 ‚úÖ
  H1:  regime=range, confidence=0.65

TimeframeSelector:
  ‚Üí PRIMARY_TF = M15
  ‚Üí Reason: "M5 –Ω–µ–¥–æ—Å—Ç–∞—Ç–æ—á–Ω–æ —É–≤–µ—Ä–µ–Ω, –ø–µ—Ä–µ—Ö–æ–¥ –Ω–∞ M15 (confidence=0.72)"
  ‚Üí should_trade = True

–†–µ–∑—É–ª—å—Ç–∞—Ç: –ò—â–µ–º —Å–∏–≥–Ω–∞–ª—ã –Ω–∞ M15 (RangeStrategy)
```

### –°—Ü–µ–Ω–∞—Ä–∏–π 3: –í–æ–ª–∞—Ç–∏–ª—å–Ω–æ—Å—Ç—å –Ω–∞ –≤—Å–µ—Ö TF

```
AI —Å–∏–≥–Ω–∞–ª—ã:
  M5:  regime=volatile, confidence=0.40 ‚ùå
  M15: regime=volatile, confidence=0.50 ‚ùå
  H1:  regime=volatile, confidence=0.55 ‚ùå
  H4:  regime=volatile, confidence=0.60 ‚ùå

TimeframeSelector:
  ‚Üí PRIMARY_TF = M5 (—Å–æ—Ö—Ä–∞–Ω—è–µ–º —Ç–µ–∫—É—â–∏–π)
  ‚Üí Reason: "–í—Å–µ TF –≤ –≤—ã—Å–æ–∫–æ–π –≤–æ–ª–∞—Ç–∏–ª—å–Ω–æ—Å—Ç–∏"
  ‚Üí should_trade = False ‚ùå
  ‚Üí Context: "H1: –≤–æ–ª–∞—Ç–∏–ª—å–Ω–æ—Å—Ç—å | H4: –≤—ã—Å–æ–∫–∞—è –≤–æ–ª–∞—Ç–∏–ª—å–Ω–æ—Å—Ç—å"

–†–µ–∑—É–ª—å—Ç–∞—Ç: NO TRADE (—Å—Ç—Ä–∞—Ç–µ–≥–∏—è –∂–¥—ë—Ç)
```

---

## ‚úÖ –¢–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ

### –ò–º–ø–æ—Ä—Ç—ã —Ä–∞–±–æ—Ç–∞—é—Ç:

```powershell
PS> python -c "from strategy import TimeframeSelector, TimeframeData, Timeframe, Regime; print('‚úÖ OK')"
‚úÖ OK
```

### –ö–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏—è –≤–∞–ª–∏–¥–Ω–∞:

```powershell
PS> python -c "from strategy import StrategyConfig; c = StrategyConfig(tf_selector_enable=True); c.validate(); print('‚úÖ Config valid')"
‚úÖ Config valid
```

---

## üìä –°—Ç–∞—Ç–∏—Å—Ç–∏–∫–∞

### –ö–æ–¥:
- **–ù–æ–≤—ã–µ —Ñ–∞–π–ª—ã:** 1 (timeframe_selector.py, 350 —Å—Ç—Ä–æ–∫)
- **–ò–∑–º–µ–Ω—ë–Ω–Ω—ã–µ —Ñ–∞–π–ª—ã:** 5 (ai_client, config, hybrid_strategy, backtest_engine, __init__)
- **–í—Å–µ–≥–æ –¥–æ–±–∞–≤–ª–µ–Ω–æ:** ~620 —Å—Ç—Ä–æ–∫ –∫–æ–¥–∞

### –î–æ–∫—É–º–µ–Ω—Ç–∞—Ü–∏—è:
- **MULTITIMEFRAME_SPECIFICATION.md:** 500 —Å—Ç—Ä–æ–∫
- **MULTITIMEFRAME_CHANGELOG.md:** 350 —Å—Ç—Ä–æ–∫
- **README.md:** –æ–±–Ω–æ–≤–ª—ë–Ω
- **–í—Å–µ–≥–æ:** ~850 —Å—Ç—Ä–æ–∫ –¥–æ–∫—É–º–µ–Ω—Ç–∞—Ü–∏–∏

### –ò—Ç–æ–≥–æ: **~1470 —Å—Ç—Ä–æ–∫** –∫–æ–¥–∞ –∏ –¥–æ–∫—É–º–µ–Ω—Ç–∞—Ü–∏–∏

---

## üöÄ –ü—Ä–µ–∏–º—É—â–µ—Å—Ç–≤–∞

1. ‚úÖ **–î–∏–Ω–∞–º–∏—á–µ—Å–∫–∏–π –≤—ã–±–æ—Ä TF:** PRIMARY_TF –º–µ–Ω—è–µ—Ç—Å—è –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏
2. ‚úÖ **–ö–æ–Ω—Ç–µ–∫—Å—Ç–Ω–∞—è —Ñ–∏–ª—å—Ç—Ä–∞—Ü–∏—è:** H1/H4 –∑–∞—â–∏—â–∞—é—Ç –æ—Ç –ª–æ–∂–Ω—ã—Ö —Å–∏–≥–Ω–∞–ª–æ–≤
3. ‚úÖ **–¢–æ—á–Ω—ã–µ –≤—Ö–æ–¥—ã:** M5 –¥–∞—ë—Ç —Ç–æ—á–∫–∏ –≤—Ö–æ–¥–∞ –ø—Ä–∏ —Ç—Ä–µ–Ω–¥–µ –Ω–∞ H1
4. ‚úÖ **–ó–∞—â–∏—Ç–∞ –æ—Ç —Ö–∞–æ—Å–∞:** NO TRADE –ø—Ä–∏ –≤–æ–ª–∞—Ç–∏–ª—å–Ω–æ—Å—Ç–∏
5. ‚úÖ **–ü—Ä–æ–∑—Ä–∞—á–Ω–æ—Å—Ç—å:** –õ–æ–≥–∏—Ä–æ–≤–∞–Ω–∏–µ –ø—Ä–∏—á–∏–Ω –≤—ã–±–æ—Ä–∞ PRIMARY_TF
6. ‚úÖ **–û–±—Ä–∞—Ç–Ω–∞—è —Å–æ–≤–º–µ—Å—Ç–∏–º–æ—Å—Ç—å:** –°—Ç–∞—Ä—ã–π –∫–æ–¥ —Ä–∞–±–æ—Ç–∞–µ—Ç –±–µ–∑ –∏–∑–º–µ–Ω–µ–Ω–∏–π

---

## ‚ö†Ô∏è –û–≥—Ä–∞–Ω–∏—á–µ–Ω–∏—è v1.0

1. –ü—Ä–æ—Å—Ç—ã–µ –ø—Ä–∞–≤–∏–ª–∞ –≤—ã–±–æ—Ä–∞ TF (—Ñ–∏–∫—Å–∏—Ä–æ–≤–∞–Ω–Ω—ã–µ –ø–æ—Ä–æ–≥–∏, –±–µ–∑ ML)
2. –ù–µ—Ç self-learning (—Å–µ–ª–µ–∫—Ç–æ—Ä –Ω–µ –∞–¥–∞–ø—Ç–∏—Ä—É–µ—Ç—Å—è –Ω–∞ –æ—Å–Ω–æ–≤–µ —Ä–µ–∑—É–ª—å—Ç–∞—Ç–æ–≤)
3. –§–∏–∫—Å–∏—Ä–æ–≤–∞–Ω–Ω—ã–π –Ω–∞–±–æ—Ä TF (M1, M5, M15, H1, H4)
4. –¢—Ä–µ–±—É–µ—Ç—Å—è —Ä–µ–∞–ª–∏–∑–∞—Ü–∏—è `/predict_multitimeframe` –Ω–∞ AI Core

---

## üìÖ Roadmap v1.1+

1. **Adaptive TimeframeSelector:**
   - –û–±—É—á–µ–Ω–∏–µ –Ω–∞ –æ—Å–Ω–æ–≤–µ ROI/WinRate –ø–æ TF
   - –î–∏–Ω–∞–º–∏—á–µ—Å–∫–æ–µ –∏–∑–º–µ–Ω–µ–Ω–∏–µ –ø–æ—Ä–æ–≥–æ–≤

2. **Multi-TF confirmation:**
   - –¢—Ä–µ–±–æ–≤–∞–Ω–∏–µ —Å–æ–≤–ø–∞–¥–µ–Ω–∏—è –Ω–∞–ø—Ä–∞–≤–ª–µ–Ω–∏–π –Ω–∞ 2+ TF

3. **News filter:**
   - –û—Ç–∫–ª—é—á–µ–Ω–∏–µ –∑–∞ 15 –º–∏–Ω –¥–æ/–ø–æ—Å–ª–µ –Ω–æ–≤–æ—Å—Ç–µ–π

4. **Extended TF:**
   - –ü–æ–¥–¥–µ—Ä–∂–∫–∞ D1, W1

---

## üìù –ß—Ç–æ –¥–∞–ª—å—à–µ?

### –°–ª–µ–¥—É—é—â–∏–µ —à–∞–≥–∏:

1. **–†–µ–∞–ª–∏–∑–æ–≤–∞—Ç—å `/predict_multitimeframe` –≤ AI Core:**
   ```python
   @app.post("/predict_multitimeframe")
   async def predict_multitimeframe(request: MultitimeframeRequest):
       # –û–±—Ä–∞–±–æ—Ç–∫–∞ –∫–∞–∂–¥–æ–≥–æ TF
       results = {}
       for tf, candles in request.timeframes_data.items():
           results[tf] = await predict_single_timeframe(candles)
       return results
   ```

2. **–ü–æ–¥–≥–æ—Ç–æ–≤–∏—Ç—å –º—É–ª—å—Ç–∏—Ç–∞–π–º—Ñ—Ä–µ–π–º–æ–≤—ã–µ –¥–∞–Ω–Ω—ã–µ:**
   ```python
   # –ó–∞–≥—Ä—É–∑–∏—Ç—å –∏–∑ MT5 –∏–ª–∏ CSV
   df_m5 = load_data("M5")
   df_m15 = load_data("M15")
   df_h1 = load_data("H1")
   df_h4 = load_data("H4")
   
   # –î–æ–±–∞–≤–∏—Ç—å –∏–Ω–¥–∏–∫–∞—Ç–æ—Ä—ã
   for df in [df_m5, df_m15, df_h1, df_h4]:
       df['sma'] = df['close'].rolling(20).mean()
       df['atr'] = calculate_atr(df)
       df['rsi'] = calculate_rsi(df)
   ```

3. **–ó–∞–ø—É—Å—Ç–∏—Ç—å backtesting:**
   ```python
   backtest.load_multitf_data({
       "M5": df_m5, "M15": df_m15, "H1": df_h1, "H4": df_h4
   })
   backtest.run()
   ```

4. **–ê–Ω–∞–ª–∏–∑–∏—Ä–æ–≤–∞—Ç—å –ª–æ–≥–∏:**
   - –ß–∞—Å—Ç–æ—Ç–∞ —Å–º–µ–Ω—ã PRIMARY_TF
   - –°–æ–æ—Ç–Ω–æ—à–µ–Ω–∏–µ trades –Ω–∞ M5 vs M15 vs H1
   - –í–ª–∏—è–Ω–∏–µ –∫–æ–Ω—Ç–µ–∫—Å—Ç–Ω—ã—Ö —Ñ–∏–ª—å—Ç—Ä–æ–≤

---

## üéâ –ó–∞–∫–ª—é—á–µ–Ω–∏–µ

**–ú—É–ª—å—Ç–∏—Ç–∞–π–º—Ñ—Ä–µ–π–º–æ–≤–∞—è –∞—Ä—Ö–∏—Ç–µ–∫—Ç—É—Ä–∞ –ø–æ–ª–Ω–æ—Å—Ç—å—é —Ä–µ–∞–ª–∏–∑–æ–≤–∞–Ω–∞ –∏ –≥–æ—Ç–æ–≤–∞ –∫ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏—é!**

–≠—Ç–æ –∏–º–µ–Ω–Ω–æ —Ç–∞ –∞—Ä—Ö–∏—Ç–µ–∫—Ç—É—Ä–∞, –∫–æ—Ç–æ—Ä—É—é –≤—ã –∑–∞–ø—Ä–æ—Å–∏–ª–∏:

> ‚úÖ –ù–µ "—Å–≤–µ—á–∫–∞ –≤–≤–µ—Ä—Ö-–≤–Ω–∏–∑"  
> ‚úÖ –í–∏–¥–∏—Ç —Ä—ã–Ω–æ–∫ –≤ —Ä–∞–∑–Ω—ã—Ö –º–∞—Å—à—Ç–∞–±–∞—Ö  
> ‚úÖ –ê–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏ –≤—ã–±–∏—Ä–∞–µ—Ç –æ–ø—Ç–∏–º–∞–ª—å–Ω—ã–π TF  
> ‚úÖ –†–∞–±–æ—Ç–∞–µ—Ç –≤–Ω—É—Ç—Ä–∏ —Å–≤–µ—á–∏ (–Ω–µ –ø–æ Open/Close)  
> ‚úÖ –ò—Å–ø–æ–ª—å–∑—É–µ—Ç –∫–æ–Ω—Ç–µ–∫—Å—Ç —Å—Ç–∞—Ä—à–∏—Ö TF  
> ‚úÖ –ó–∞—â–∏—Ç–∞ –æ—Ç —Ö–∞–æ—Å–∞  

**–í—Å—ë –≥–æ—Ç–æ–≤–æ –¥–ª—è —Ç–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏—è! üöÄ**

---

**–°—Ç–∞—Ç—É—Å:** ‚úÖ **–ó–ê–í–ï–†–®–ï–ù–û**  
**–í–µ—Ä—Å–∏—è:** 1.0  
**–î–∞—Ç–∞:** 2024-12-01
