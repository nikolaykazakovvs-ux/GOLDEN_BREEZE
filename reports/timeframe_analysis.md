# üìä –ü–û–õ–ù–´–ô –û–ë–ó–û–† –î–û–°–¢–£–ü–ù–´–• –î–ê–ù–ù–´–•

## üóìÔ∏è –ü–µ—Ä–∏–æ–¥: 19-28 –Ω–æ—è–±—Ä—è 2025 (9 –¥–Ω–µ–π)

---

## üìà –í—Å–µ –ó–∞–≥—Ä—É–∂–µ–Ω–Ω—ã–µ –¢–∞–π–º—Ñ—Ä–µ–π–º—ã:

| –¢–∞–π–º—Ñ—Ä–µ–π–º | –°–≤–µ—á–µ–π | –ü–µ—Ä–∏–æ–¥ | –ò—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏–µ |
|-----------|--------|--------|---------------|
| **M1** | 9,565 | 19 Nov 22:00 - 28 Nov 21:44 | ‚ùå –ù–µ –∏—Å–ø–æ–ª—å–∑—É–µ—Ç—Å—è |
| **M5** | 1,927 | 19 Nov 22:00 - 28 Nov 21:40 | ‚úÖ **–û–ë–£–ß–ï–ù–ò–ï –ú–û–î–ï–õ–ò** |
| **M15** | 643 | 19 Nov 22:00 - 28 Nov 21:30 | ‚ùå –ù–µ –∏—Å–ø–æ–ª—å–∑—É–µ—Ç—Å—è |
| **H1** | 161 | 19 Nov 22:00 - 28 Nov 21:00 | ‚ùå –ù–µ –∏—Å–ø–æ–ª—å–∑—É–µ—Ç—Å—è |
| **H4** | 42 | 20 Nov 00:00 - 28 Nov 20:00 | ‚ö†Ô∏è –ò—Å–ø–æ–ª—å–∑—É–µ—Ç—Å—è –¥–ª—è S/R levels |

---

## üéØ –¢–µ–∫—É—â–µ–µ –ò—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏–µ:

### 1. –û—Å–Ω–æ–≤–Ω–æ–µ –û–±—É—á–µ–Ω–∏–µ:
**–¢–∞–π–º—Ñ—Ä–µ–π–º:** M5 (5 –º–∏–Ω—É—Ç)  
**–î–∞–Ω–Ω—ã—Ö:** 1,927 —Å–≤–µ—á–µ–π  
**–ú–æ–¥–µ–ª—å:** `direction_lstm_gold_v2.pt`

**–ü–æ—á–µ–º—É M5:**
- ‚úÖ –î–æ—Å—Ç–∞—Ç–æ—á–Ω–æ –¥–∞–Ω–Ω—ã—Ö –¥–ª—è LSTM (seq_len=50 —Ç—Ä–µ–±—É–µ—Ç –º–∏–Ω–∏–º—É–º ~300 —Å–≤–µ—á–µ–π)
- ‚úÖ –•–æ—Ä–æ—à–∏–π –±–∞–ª–∞–Ω—Å: –Ω–µ —Å–ª–∏—à–∫–æ–º —à—É–º–Ω—ã–π (–∫–∞–∫ M1), –Ω–µ —Å–ª–∏—à–∫–æ–º –º–µ–¥–ª–µ–Ω–Ω—ã–π (–∫–∞–∫ H1)
- ‚úÖ –ü–æ–¥—Ö–æ–¥–∏—Ç –¥–ª—è —Å–∫–∞–ª—å–ø–∏–Ω–≥–∞ –∏ –∏–Ω—Ç—Ä–∞–¥–µ–π

---

### 2. Multi-Timeframe Features:
**H4 –¥–ª—è Support/Resistance:**
- –ò—Å–ø–æ–ª—å–∑—É–µ—Ç—Å—è –≤ `features_gold.py`
- –§—É–Ω–∫—Ü–∏—è: `add_support_resistance_static()`
- 42 —Å–≤–µ—á–∏ H4 ‚Üí —Å—Ç–∞—Ç–∏—á–µ—Å–∫–∏–µ —É—Ä–æ–≤–Ω–∏ –¥–ª—è M5 –¥–∞–Ω–Ω—ã—Ö

---

## üìä –î–µ—Ç–∞–ª—å–Ω–∞—è –°—Ç–∞—Ç–∏—Å—Ç–∏–∫–∞:

### M1 (1-–º–∏–Ω—É—Ç–Ω—ã–π) - 9,565 —Å–≤–µ—á–µ–π
```
–ü–µ—Ä–∏–æ–¥: 9 –¥–Ω–µ–π 23 —á–∞—Å–∞ 44 –º–∏–Ω—É—Ç—ã
–°—Ä–µ–¥–Ω—è—è: ~1,062 —Å–≤–µ—á–µ–π/–¥–µ–Ω—å
–ü–æ–∫—Ä—ã—Ç–∏–µ: –ü–æ—á—Ç–∏ –Ω–µ–ø—Ä–µ—Ä—ã–≤–Ω–æ–µ (9,565 –∏–∑ 12,960 –≤–æ–∑–º–æ–∂–Ω—ã—Ö = 73.8%)
```

**–ü–æ—á–µ–º—É –Ω–µ –∏—Å–ø–æ–ª—å–∑—É–µ—Ç—Å—è:**
- ‚ùå –°–ª–∏—à–∫–æ–º —à—É–º–Ω—ã–π –¥–ª—è LSTM
- ‚ùå –ú–Ω–æ–≥–æ –ª–æ–∂–Ω—ã—Ö —Å–∏–≥–Ω–∞–ª–æ–≤
- ‚ùå –¢—Ä–µ–±—É–µ—Ç –±–æ–ª–µ–µ —Å–ª–æ–∂–Ω–æ–π —Ñ–∏–ª—å—Ç—Ä–∞—Ü–∏–∏

**–ö–æ–≥–¥–∞ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å:**
- –î–ª—è tick-level –∞–Ω–∞–ª–∏–∑–∞
- –î–ª—è HFT —Å—Ç—Ä–∞—Ç–µ–≥–∏–π
- –î–ª—è intrabar execution

---

### M5 (5-–º–∏–Ω—É—Ç–Ω—ã–π) - 1,927 —Å–≤–µ—á–µ–π ‚úÖ –ò–°–ü–û–õ–¨–ó–£–ï–¢–°–Ø
```
–ü–µ—Ä–∏–æ–¥: 9 –¥–Ω–µ–π 23 —á–∞—Å–∞ 40 –º–∏–Ω—É—Ç
–°—Ä–µ–¥–Ω—è—è: ~214 —Å–≤–µ—á–µ–π/–¥–µ–Ω—å
–ü–æ–∫—Ä—ã—Ç–∏–µ: 1,927 –∏–∑ 2,592 –≤–æ–∑–º–æ–∂–Ω—ã—Ö = 74.3%
```

**–ò—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏–µ:**
- ‚úÖ –û–±—É—á–µ–Ω–∏–µ LSTM –º–æ–¥–µ–ª–∏
- ‚úÖ –ì–µ–Ω–µ—Ä–∞—Ü–∏—è labels (direction_labels_XAUUSD.csv)
- ‚úÖ –í—Å–µ 32 —Ñ–∏—á–∏ (–±–∞–∑–æ–≤—ã–µ + Gold)

**Sequences:**
- Raw: 1,927 bars
- After features: 1,728 bars (199 dropped –¥–ª—è EMA_200)
- Final sequences: 1,305 (seq_len=50)

---

### M15 (15-–º–∏–Ω—É—Ç–Ω—ã–π) - 643 —Å–≤–µ—á–∏
```
–ü–µ—Ä–∏–æ–¥: 9 –¥–Ω–µ–π 23 —á–∞—Å–∞ 30 –º–∏–Ω—É—Ç
–°—Ä–µ–¥–Ω—è—è: ~71 —Å–≤–µ—á–µ–π/–¥–µ–Ω—å
–ü–æ–∫—Ä—ã—Ç–∏–µ: 643 –∏–∑ 864 –≤–æ–∑–º–æ–∂–Ω—ã—Ö = 74.4%
```

**–ü–æ—á–µ–º—É –Ω–µ –∏—Å–ø–æ–ª—å–∑—É–µ—Ç—Å—è:**
- ‚ö†Ô∏è –ú–µ–Ω—å—à–µ –¥–∞–Ω–Ω—ã—Ö —á–µ–º M5 (643 vs 1,927)
- ‚ö†Ô∏è –ù–µ–¥–æ—Å—Ç–∞—Ç–æ—á–Ω–æ –¥–ª—è LSTM —Å seq_len=50

**–ö–æ–≥–¥–∞ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å:**
- –î–ª—è swing trading
- –î–ª—è Multi-Timeframe –∞–Ω–∞–ª–∏–∑–∞ (confirmation)
- –î–ª—è –±–æ–ª–µ–µ —Å—Ç–∞–±–∏–ª—å–Ω—ã—Ö —Å–∏–≥–Ω–∞–ª–æ–≤

---

### H1 (1-—á–∞—Å–æ–≤–æ–π) - 161 —Å–≤–µ—á–∞
```
–ü–µ—Ä–∏–æ–¥: 9 –¥–Ω–µ–π 23 —á–∞—Å–∞
–°—Ä–µ–¥–Ω—è—è: ~18 —Å–≤–µ—á–µ–π/–¥–µ–Ω—å
–ü–æ–∫—Ä—ã—Ç–∏–µ: 161 –∏–∑ 216 –≤–æ–∑–º–æ–∂–Ω—ã—Ö = 74.5%
```

**–ü–æ—á–µ–º—É –Ω–µ –∏—Å–ø–æ–ª—å–∑—É–µ—Ç—Å—è:**
- ‚ùå –°–ª–∏—à–∫–æ–º –º–∞–ª–æ –¥–∞–Ω–Ω—ã—Ö –¥–ª—è LSTM (161 < 300 minimum)
- ‚ùå seq_len=50 ‚Üí —Ç–æ–ª—å–∫–æ 111 sequences (–Ω–µ–¥–æ—Å—Ç–∞—Ç–æ—á–Ω–æ)

**–ö–æ–≥–¥–∞ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å:**
- –î–ª—è position trading
- –î–ª—è trend analysis
- –î–ª—è Multi-Timeframe context

---

### H4 (4-—á–∞—Å–æ–≤–æ–π) - 42 —Å–≤–µ—á–∏ ‚ö†Ô∏è –ß–ê–°–¢–ò–ß–ù–û –ò–°–ü–û–õ–¨–ó–£–ï–¢–°–Ø
```
–ü–µ—Ä–∏–æ–¥: 8 –¥–Ω–µ–π 20 —á–∞—Å–æ–≤
–°—Ä–µ–¥–Ω—è—è: ~5 —Å–≤–µ—á–µ–π/–¥–µ–Ω—å
–ü–æ–∫—Ä—ã—Ç–∏–µ: 42 –∏–∑ 54 –≤–æ–∑–º–æ–∂–Ω—ã—Ö = 77.8%
```

**–ò—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏–µ:**
- ‚úÖ Support/Resistance levels (–≤ features_gold.py)
- –ë–µ—Ä–µ–º –ø—Ä–µ–¥—ã–¥—É—â—É—é —Å–≤–µ—á—É H4 ‚Üí Low=Support, High=Resistance
- –î–æ–±–∞–≤–ª—è–µ–º –∫–∞–∫ —Å—Ç–∞—Ç–∏—á–µ—Å–∫–∏–µ —É—Ä–æ–≤–Ω–∏ –≤ M5 –¥–∞–Ω–Ω—ã–µ

**–ü–æ—á–µ–º—É –Ω–µ –¥–ª—è –æ–±—É—á–µ–Ω–∏—è:**
- ‚ùå –ö–∞—Ç–∞—Å—Ç—Ä–æ—Ñ–∏—á–µ—Å–∫–∏ –º–∞–ª–æ –¥–∞–Ω–Ω—ã—Ö (42 —Å–≤–µ—á–∏)
- ‚ùå seq_len=50 –Ω–µ–≤–æ–∑–º–æ–∂–µ–Ω

---

## üîÑ Multi-Timeframe Pipeline:

### –¢–µ–∫—É—â–∞—è –†–µ–∞–ª–∏–∑–∞—Ü–∏—è:
```
1. M5 (primary) ‚Üí LSTM training
2. H4 ‚Üí Support/Resistance levels
```

### –ö–∞–∫ –†–∞–±–æ—Ç–∞–µ—Ç:
```python
# –í features_gold.py:
def add_support_resistance_static(df_m5, higher_tf_data=df_h4):
    # –ë–µ—Ä–µ–º –ø—Ä–µ–¥—ã–¥—É—â—É—é —Å–≤–µ—á—É H4
    previous_candle = higher_tf_data.iloc[-2]
    support = previous_candle['low']
    resistance = previous_candle['high']
    
    # –î–æ–±–∞–≤–ª—è–µ–º –≤ –∫–∞–∂–¥—É—é —Å—Ç—Ä–æ–∫—É M5
    df_m5['Support_4H'] = support
    df_m5['Resistance_4H'] = resistance
    
    # Distance features
    df_m5['Distance_To_Support'] = (df_m5['close'] - support) / df_m5['close']
    df_m5['Distance_To_Resistance'] = (resistance - df_m5['close']) / df_m5['close']
```

---

## üéØ –ü–æ—á–µ–º—É –í—ã–±—Ä–∞–Ω M5:

### –ü—Ä–µ–∏–º—É—â–µ—Å—Ç–≤–∞:
1. ‚úÖ **–î–æ—Å—Ç–∞—Ç–æ—á–Ω–æ –¥–∞–Ω–Ω—ã—Ö:** 1,927 —Å–≤–µ—á–µ–π ‚Üí 1,305 sequences
2. ‚úÖ **–ë–∞–ª–∞–Ω—Å —à—É–º/—Å–∏–≥–Ω–∞–ª:** –ù–µ —Å–ª–∏—à–∫–æ–º —à—É–º–Ω—ã–π, –Ω–µ —Å–ª–∏—à–∫–æ–º –º–µ–¥–ª–µ–Ω–Ω—ã–π
3. ‚úÖ **–ò–Ω—Ç—Ä–∞–¥–µ–π trading:** –ü–æ–¥—Ö–æ–¥–∏—Ç –¥–ª—è —Å–µ—Å—Å–∏–æ–Ω–Ω–æ–π —Ç–æ—Ä–≥–æ–≤–ª–∏
4. ‚úÖ **–ë—ã—Å—Ç—Ä–∞—è —Ä–µ–∞–∫—Ü–∏—è:** 5 –º–∏–Ω—É—Ç –¥–æ—Å—Ç–∞—Ç–æ—á–Ω–æ –±—ã—Å—Ç—Ä–æ –¥–ª—è Gold
5. ‚úÖ **EMA_200 —Ä–∞–±–æ—Ç–∞–µ—Ç:** 200 —Å–≤–µ—á–µ–π √ó 5 –º–∏–Ω = 16.7 —á–∞—Å–æ–≤ lookback

### –ù–µ–¥–æ—Å—Ç–∞—Ç–∫–∏:
1. ‚ö†Ô∏è **–ö–æ—Ä–æ—Ç–∫–∏–π –ø–µ—Ä–∏–æ–¥:** –¢–æ–ª—å–∫–æ 9 –¥–Ω–µ–π
2. ‚ö†Ô∏è **–ù–µ—Ç —Ä–∞–∑–Ω–æ–æ–±—Ä–∞–∑–∏—è:** –¢–æ–ª—å–∫–æ –æ–¥–∏–Ω —Ä—ã–Ω–æ—á–Ω—ã–π —Ä–µ–∂–∏–º (range)
3. ‚ö†Ô∏è **–ú–∞–ª–æ H4 –¥–∞–Ω–Ω—ã—Ö:** –¢–æ–ª—å–∫–æ 42 —Å–≤–µ—á–∏ –¥–ª—è S/R

---

## üí° –†–µ–∫–æ–º–µ–Ω–¥–∞—Ü–∏–∏:

### –î–ª—è –£–ª—É—á—à–µ–Ω–∏—è:

#### 1. –≠–∫—Å–ø–æ—Ä—Ç–∏—Ä–æ–≤–∞—Ç—å –ë–æ–ª—å—à–µ –î–∞–Ω–Ω—ã—Ö:
```bash
# M5 - 3 –º–µ—Å—è—Ü–∞ (25,920 —Å–≤–µ—á–µ–π)
python tools/export_mt5_history.py XAUUSD M5 25000

# H4 - 3 –º–µ—Å—è—Ü–∞ (540 —Å–≤–µ—á–µ–π)
python tools/export_mt5_history.py XAUUSD H4 600

# M15 - –¥–ª—è Multi-TF –∞–Ω–∞–ª–∏–∑–∞ (8,640 —Å–≤–µ—á–µ–π)
python tools/export_mt5_history.py XAUUSD M15 8000
```

#### 2. Multi-Timeframe Training:
```python
# –ò–¥–µ—è: –û–±—É—á–∞—Ç—å –º–æ–¥–µ–ª—å –Ω–∞ —Ä–∞–∑–Ω—ã—Ö TF –æ–¥–Ω–æ–≤—Ä–µ–º–µ–Ω–Ω–æ
features_m5 = get_features(df_m5)
features_m15 = get_features(df_m15)
features_h1 = get_features(df_h1)

# Merge –∏ align –ø–æ timestamp
combined = merge_multi_tf([features_m5, features_m15, features_h1])

# Train LSTM –Ω–∞ combined features
model.train(combined)
```

#### 3. Rolling Window:
```python
# –í–º–µ—Å—Ç–æ static train/test split
for window in rolling_windows(data, window_size=2000, step=500):
    train, test = split(window)
    model.train(train)
    metrics = model.evaluate(test)
    save_metrics(metrics)
```

---

## üìä Coverage Analysis:

### –ü–æ—á–µ–º—É ~74% Coverage?

**–ü—Ä–∏—á–∏–Ω–∞:** –ù–µ—Ç–æ—Ä–≥–æ–≤—ã–µ —á–∞—Å—ã (weekend gaps, low liquidity)

**–†–∞—Å—á–µ—Ç –¥–ª—è M5:**
- –¢–µ–æ—Ä–µ—Ç–∏—á–µ—Å–∫–∏: 9 –¥–Ω–µ–π √ó 24 —á–∞—Å–∞ √ó 12 —Å–≤–µ—á–µ–π/—á–∞—Å = 2,592 —Å–≤–µ—á–∏
- –§–∞–∫—Ç–∏—á–µ—Å–∫–∏: 1,927 —Å–≤–µ—á–µ–π
- Coverage: 74.3%
- **Missing:** 665 —Å–≤–µ—á–µ–π (25.7%)

**Missing Time:**
- Weekends: –°—É–±–±–æ—Ç–∞-–í–æ—Å–∫—Ä–µ—Å–µ–Ω—å–µ (–Ω–µ—Ç —Ç–æ—Ä–≥–æ–≤–ª–∏ Forex)
- Low liquidity: Asian session gaps
- Data gaps: MT5 broker specifics

**Verdict:** 74% - —ç—Ç–æ –Ω–æ—Ä–º–∞–ª—å–Ω–æ –¥–ª—è Forex/Gold –¥–∞–Ω–Ω—ã—Ö!

---

## üéØ Optimal Timeframe Strategy:

### –î–ª—è –†–∞–∑–Ω—ã—Ö –°—Ç–∏–ª–µ–π:

#### Scalping (M1-M5):
- **Primary:** M5 ‚úÖ (–∏—Å–ø–æ–ª—å–∑—É–µ–º)
- **Confirmation:** M15
- **Context:** H1
- **S/R:** H4 ‚úÖ (–∏—Å–ø–æ–ª—å–∑—É–µ–º)

#### Day Trading (M15-H1):
- **Primary:** M15 –∏–ª–∏ H1
- **Confirmation:** H4
- **Context:** D1
- **–ù—É–∂–Ω–æ:** –ë–æ–ª—å—à–µ –¥–∞–Ω–Ω—ã—Ö!

#### Swing Trading (H4-D1):
- **Primary:** H4 –∏–ª–∏ D1
- **Confirmation:** W1
- **–ù—É–∂–Ω–æ:** –ú–Ω–æ–≥–æ –±–æ–ª—å—à–µ –¥–∞–Ω–Ω—ã—Ö (–º–µ—Å—è—Ü—ã/–≥–æ–¥—ã)

**–¢–µ–∫—É—â–∞—è –°—Ç—Ä–∞—Ç–µ–≥–∏—è:** Scalping/Intraday (M5 primary)

---

## üî¨ Data Quality Check:

### M5 Quality:
```
‚úÖ No duplicates
‚úÖ Chronological order
‚úÖ ~74% coverage (normal)
‚úÖ No extreme outliers (checked during feature eng)
‚ö†Ô∏è Short period (9 days only)
```

### H4 Quality:
```
‚úÖ No duplicates
‚úÖ Chronological order
‚úÖ ~78% coverage (good)
‚ö†Ô∏è Very few candles (42 total)
‚ö†Ô∏è Not enough for standalone training
```

---

## üìà Future Expansion Plan:

### Phase 1 (This Week):
```bash
# Export 3 months M5
python tools/export_mt5_history.py XAUUSD M5 25000
# ‚Üí 25,000 —Å–≤–µ—á–µ–π √ó 5 min = 86.8 –¥–Ω–µ–π

# Retrain
python -m aimodule.training.prepare_direction_dataset ...
python -m aimodule.training.train_direction_lstm_from_labels ...
```

### Phase 2 (Next Week):
```bash
# Add M15 Multi-TF
python tools/export_mt5_history.py XAUUSD M15 8000
# Train M15 model
# Compare M5 vs M15 performance
```

### Phase 3 (Next Month):
```bash
# Add H1 for position trading
python tools/export_mt5_history.py XAUUSD H1 2000
# Multi-TF ensemble: M5 + M15 + H1
```

---

## üéØ Summary:

### –î–æ—Å—Ç—É–ø–Ω—ã–µ –¢–∞–π–º—Ñ—Ä–µ–π–º—ã:
| TF | –°–≤–µ—á–µ–π | –ò—Å–ø–æ–ª—å–∑—É–µ—Ç—Å—è | –°—Ç–∞—Ç—É—Å |
|----|--------|--------------|--------|
| M1 | 9,565 | ‚ùå | –†–µ–∑–µ—Ä–≤ (—Å–ª–∏—à–∫–æ–º —à—É–º–Ω—ã–π) |
| **M5** | **1,927** | ‚úÖ | **–û–°–ù–û–í–ù–û–ï –û–ë–£–ß–ï–ù–ò–ï** |
| M15 | 643 | ‚ùå | –ú–∞–ª–æ –¥–∞–Ω–Ω—ã—Ö (–º–æ–∂–Ω–æ –¥–æ–±–∞–≤–∏—Ç—å) |
| H1 | 161 | ‚ùå | –ú–∞–ª–æ –¥–∞–Ω–Ω—ã—Ö |
| **H4** | **42** | ‚úÖ | **S/R LEVELS** |

### –ü–µ—Ä–∏–æ–¥ –î–∞–Ω–Ω—ã—Ö:
**19-28 –Ω–æ—è–±—Ä—è 2025** (9 –¥–Ω–µ–π)

### –ö–∞—á–µ—Å—Ç–≤–æ:
- ‚úÖ Coverage: ~74% (normal)
- ‚úÖ No major gaps
- ‚ö†Ô∏è Short period (need 3+ months)
- ‚ö†Ô∏è Single regime (range-bound)

### Next Steps:
1. üî• Backtest –Ω–∞ M5 —Å —Ç–µ–∫—É—â–µ–π –º–æ–¥–µ–ª—å—é
2. üî• Export 3 months M5 data
3. üî• Retrain –Ω–∞ –±–æ–ª—å—à–∏—Ö –¥–∞–Ω–Ω—ã—Ö
4. üìä Add M15 –¥–ª—è Multi-TF
5. üöÄ Live test –Ω–∞ demo

---

**Generated:** 03.12.2025 05:50  
**Data Coverage:** 19-28 Nov 2025 (9 days)  
**Primary TF:** M5 (1,927 bars)  
**Model:** direction_lstm_gold_v2.pt  
